{"ast":null,"code":"import _inheritsLoose from \"@babel/runtime/helpers/esm/inheritsLoose\";\nimport { notifyManager } from './notifyManager';\nimport { Mutation } from './mutation';\nimport { matchMutation, noop } from './utils';\nimport { Subscribable } from './subscribable'; // TYPES\n// CLASS\n\nexport var MutationCache = /*#__PURE__*/function (_Subscribable) {\n  _inheritsLoose(MutationCache, _Subscribable);\n\n  function MutationCache(config) {\n    var _this;\n\n    _this = _Subscribable.call(this) || this;\n    _this.config = config || {};\n    _this.mutations = [];\n    _this.mutationId = 0;\n    return _this;\n  }\n\n  var _proto = MutationCache.prototype;\n\n  _proto.build = function build(client, options, state) {\n    var mutation = new Mutation({\n      mutationCache: this,\n      mutationId: ++this.mutationId,\n      options: client.defaultMutationOptions(options),\n      state: state,\n      defaultOptions: options.mutationKey ? client.getMutationDefaults(options.mutationKey) : undefined,\n      meta: options.meta\n    });\n    this.add(mutation);\n    return mutation;\n  };\n\n  _proto.add = function add(mutation) {\n    this.mutations.push(mutation);\n    this.notify(mutation);\n  };\n\n  _proto.remove = function remove(mutation) {\n    this.mutations = this.mutations.filter(function (x) {\n      return x !== mutation;\n    });\n    mutation.cancel();\n    this.notify(mutation);\n  };\n\n  _proto.clear = function clear() {\n    var _this2 = this;\n\n    notifyManager.batch(function () {\n      _this2.mutations.forEach(function (mutation) {\n        _this2.remove(mutation);\n      });\n    });\n  };\n\n  _proto.getAll = function getAll() {\n    return this.mutations;\n  };\n\n  _proto.find = function find(filters) {\n    if (typeof filters.exact === 'undefined') {\n      filters.exact = true;\n    }\n\n    return this.mutations.find(function (mutation) {\n      return matchMutation(filters, mutation);\n    });\n  };\n\n  _proto.findAll = function findAll(filters) {\n    return this.mutations.filter(function (mutation) {\n      return matchMutation(filters, mutation);\n    });\n  };\n\n  _proto.notify = function notify(mutation) {\n    var _this3 = this;\n\n    notifyManager.batch(function () {\n      _this3.listeners.forEach(function (listener) {\n        listener(mutation);\n      });\n    });\n  };\n\n  _proto.onFocus = function onFocus() {\n    this.resumePausedMutations();\n  };\n\n  _proto.onOnline = function onOnline() {\n    this.resumePausedMutations();\n  };\n\n  _proto.resumePausedMutations = function resumePausedMutations() {\n    var pausedMutations = this.mutations.filter(function (x) {\n      return x.state.isPaused;\n    });\n    return notifyManager.batch(function () {\n      return pausedMutations.reduce(function (promise, mutation) {\n        return promise.then(function () {\n          return mutation.continue().catch(noop);\n        });\n      }, Promise.resolve());\n    });\n  };\n\n  return MutationCache;\n}(Subscribable);","map":{"version":3,"names":["_inheritsLoose","notifyManager","Mutation","matchMutation","noop","Subscribable","MutationCache","_Subscribable","config","_this","call","mutations","mutationId","_proto","prototype","build","client","options","state","mutation","mutationCache","defaultMutationOptions","defaultOptions","mutationKey","getMutationDefaults","undefined","meta","add","push","notify","remove","filter","x","cancel","clear","_this2","batch","forEach","getAll","find","filters","exact","findAll","_this3","listeners","listener","onFocus","resumePausedMutations","onOnline","pausedMutations","isPaused","reduce","promise","then","continue","catch","Promise","resolve"],"sources":["/home/honza/node_modules/react-query/es/core/mutationCache.js"],"sourcesContent":["import _inheritsLoose from \"@babel/runtime/helpers/esm/inheritsLoose\";\nimport { notifyManager } from './notifyManager';\nimport { Mutation } from './mutation';\nimport { matchMutation, noop } from './utils';\nimport { Subscribable } from './subscribable'; // TYPES\n\n// CLASS\nexport var MutationCache = /*#__PURE__*/function (_Subscribable) {\n  _inheritsLoose(MutationCache, _Subscribable);\n\n  function MutationCache(config) {\n    var _this;\n\n    _this = _Subscribable.call(this) || this;\n    _this.config = config || {};\n    _this.mutations = [];\n    _this.mutationId = 0;\n    return _this;\n  }\n\n  var _proto = MutationCache.prototype;\n\n  _proto.build = function build(client, options, state) {\n    var mutation = new Mutation({\n      mutationCache: this,\n      mutationId: ++this.mutationId,\n      options: client.defaultMutationOptions(options),\n      state: state,\n      defaultOptions: options.mutationKey ? client.getMutationDefaults(options.mutationKey) : undefined,\n      meta: options.meta\n    });\n    this.add(mutation);\n    return mutation;\n  };\n\n  _proto.add = function add(mutation) {\n    this.mutations.push(mutation);\n    this.notify(mutation);\n  };\n\n  _proto.remove = function remove(mutation) {\n    this.mutations = this.mutations.filter(function (x) {\n      return x !== mutation;\n    });\n    mutation.cancel();\n    this.notify(mutation);\n  };\n\n  _proto.clear = function clear() {\n    var _this2 = this;\n\n    notifyManager.batch(function () {\n      _this2.mutations.forEach(function (mutation) {\n        _this2.remove(mutation);\n      });\n    });\n  };\n\n  _proto.getAll = function getAll() {\n    return this.mutations;\n  };\n\n  _proto.find = function find(filters) {\n    if (typeof filters.exact === 'undefined') {\n      filters.exact = true;\n    }\n\n    return this.mutations.find(function (mutation) {\n      return matchMutation(filters, mutation);\n    });\n  };\n\n  _proto.findAll = function findAll(filters) {\n    return this.mutations.filter(function (mutation) {\n      return matchMutation(filters, mutation);\n    });\n  };\n\n  _proto.notify = function notify(mutation) {\n    var _this3 = this;\n\n    notifyManager.batch(function () {\n      _this3.listeners.forEach(function (listener) {\n        listener(mutation);\n      });\n    });\n  };\n\n  _proto.onFocus = function onFocus() {\n    this.resumePausedMutations();\n  };\n\n  _proto.onOnline = function onOnline() {\n    this.resumePausedMutations();\n  };\n\n  _proto.resumePausedMutations = function resumePausedMutations() {\n    var pausedMutations = this.mutations.filter(function (x) {\n      return x.state.isPaused;\n    });\n    return notifyManager.batch(function () {\n      return pausedMutations.reduce(function (promise, mutation) {\n        return promise.then(function () {\n          return mutation.continue().catch(noop);\n        });\n      }, Promise.resolve());\n    });\n  };\n\n  return MutationCache;\n}(Subscribable);"],"mappings":"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"},"metadata":{},"sourceType":"module"}