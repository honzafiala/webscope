{"ast":null,"code":"var _jsxFileName = \"/home/honza/webusb-test/src/webglAppSin.js\",\n    _s = $RefreshSig$();\n\nimport React, { useEffect, useRef } from \"react\";\nimport { WebglPlot, WebglLine, ColorRGBA } from \"webgl-plot\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nlet webglp;\nlet line;\nexport default function WebglAppSin(_ref) {\n  _s();\n\n  let {\n    freq,\n    amp,\n    noise,\n    data\n  } = _ref;\n  const canvasMain = useRef(null);\n  useEffect(() => {\n    if (canvasMain.current) {\n      const devicePixelRatio = window.devicePixelRatio || 1;\n      canvasMain.current.width = canvasMain.current.clientWidth * devicePixelRatio;\n      canvasMain.current.height = canvasMain.current.clientHeight * devicePixelRatio;\n      webglp = new WebglPlot(canvasMain.current);\n      const numX = 1000;\n      line = new WebglLine(new ColorRGBA(1, 0, 0, 1), numX);\n      webglp.addLine(line);\n      line.arrangeX();\n    }\n  }, []);\n  useEffect(() => {\n    console.log('render');\n    let id = 0;\n\n    let renderPlot = () => {\n      //const freq = 0.001;\n      //const noise = 0.1;\n      //const amp = 0.5;\n      const noise1 = noise || 0.1;\n\n      for (let i = 0; i < line.numPoints; i++) {\n        const ySin = Math.sin(Math.PI * i * freq * Math.PI * 2);\n        const yNoise = Math.random() - 0.5;\n        line.setY(i, data[Math.round(i * data.length / line.numPoints)] / 10 + yNoise * 0.1);\n      }\n\n      id = requestAnimationFrame(renderPlot);\n      webglp.update();\n    };\n\n    id = requestAnimationFrame(renderPlot);\n    return () => {\n      renderPlot = () => {};\n\n      cancelAnimationFrame(id);\n    };\n  }, [freq, amp, noise, data]);\n  const canvasStyle = {\n    width: \"100%\",\n    height: \"70vh\"\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    children: [/*#__PURE__*/_jsxDEV(\"canvas\", {\n      style: canvasStyle,\n      ref: canvasMain\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 62,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      children: data.map(val => val + ' ')\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 63,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 64,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      children: [\"data points: \", data.length]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 65,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 61,\n    columnNumber: 5\n  }, this);\n}\n\n_s(WebglAppSin, \"eerRSUIQXrqWLr9QmdFUEAin0qc=\");\n\n_c = WebglAppSin;\n\nvar _c;\n\n$RefreshReg$(_c, \"WebglAppSin\");","map":{"version":3,"names":["React","useEffect","useRef","WebglPlot","WebglLine","ColorRGBA","webglp","line","WebglAppSin","freq","amp","noise","data","canvasMain","current","devicePixelRatio","window","width","clientWidth","height","clientHeight","numX","addLine","arrangeX","console","log","id","renderPlot","noise1","i","numPoints","ySin","Math","sin","PI","yNoise","random","setY","round","length","requestAnimationFrame","update","cancelAnimationFrame","canvasStyle","map","val"],"sources":["/home/honza/webusb-test/src/webglAppSin.js"],"sourcesContent":["import React, { useEffect, useRef } from \"react\";\n\nimport { WebglPlot, WebglLine, ColorRGBA } from \"webgl-plot\";\n\nlet webglp;\nlet line;\n\n\nexport default function WebglAppSin({ freq, amp, noise, data }) {\n  const canvasMain = useRef(null);\n\n  useEffect(() => {\n    if (canvasMain.current) {\n      const devicePixelRatio = window.devicePixelRatio || 1;\n      canvasMain.current.width =\n        canvasMain.current.clientWidth * devicePixelRatio;\n      canvasMain.current.height =\n        canvasMain.current.clientHeight * devicePixelRatio;\n\n      webglp = new WebglPlot(canvasMain.current);\n      const numX = 1000;\n\n      line = new WebglLine(new ColorRGBA(1, 0, 0, 1), numX);\n      webglp.addLine(line);\n\n      line.arrangeX();\n    }\n  }, []);\n\n  useEffect(() => {\n    console.log('render');\n    let id = 0;\n    let renderPlot = () => {\n      //const freq = 0.001;\n      //const noise = 0.1;\n      //const amp = 0.5;\n      const noise1 = noise || 0.1;\n\n      for (let i = 0; i < line.numPoints; i++) {\n        const ySin = Math.sin(Math.PI * i * freq * Math.PI * 2);\n        const yNoise = Math.random() - 0.5;\n        line.setY(i, data[Math.round(i * data.length/ line.numPoints)] / 10 + yNoise * 0.1);\n      }\n      id = requestAnimationFrame(renderPlot);\n      webglp.update();\n    };\n    id = requestAnimationFrame(renderPlot);\n\n    return () => {\n      renderPlot = () => {};\n      cancelAnimationFrame(id);\n    };\n  }, [freq, amp, noise, data]);\n\n  const canvasStyle = {\n    width: \"100%\",\n    height: \"70vh\"\n  };\n\n  return (\n    <div>\n      <canvas style={canvasStyle} ref={canvasMain} />\n      <div>{data.map(val => val + ' ')}</div>\n      <br/>\n      <div>data points: {data.length}</div>\n    </div>\n  );\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}